<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <h2>Current Finances</h2>
      <p id="updateTime"></p>
      <table class="table">
        <thead class="thead-light">
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Amount</th>
            <th>Type</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody id="financeData">
          <!-- Finance data will be dynamically inserted here -->
        </tbody>
      </table>
    </div>

    <!--Script begins here-->
    <script>
      function updateCurrentTime() {
        // Updates the time on webpage.
        const now = new Date();
        const currentTime =
          now.getHours() + ":" + now.getMinutes() + ":" + now.getSeconds();
        document.getElementById("updateTime").innerText =
          "Last Updated: " + currentTime;
      }
      function fetchFinanceData() {
        //Calls updateFinanceTable and updateCurrentTime
        //USED TO HAVE SIMULATED DATA HERE

        //fetch operation here
        fetch("/finance")
          .then((response) => {
            //if the response is not valid
            if (!response.ok) {
              throw new Error("Network response failed");
            }
            //else return the json response
            return response.json();
          })
          //pass the returned response to the "updateFinanceTable"
          .then((data) => {
            // Update the finance table with the received data
            updateFinanceTable(data);
            updateCurrentTime();
          })
          .catch((error) => {
            console.error(
              "Error occured with fetch",
              error
            );
          });

        updateFinanceTable(simulatedData);
        updateCurrentTime();
      }

      
      function updateFinanceTable(data) {
        const financeDataElement = document.getElementById("financeData");
        financeDataElement.innerHTML = ""; // Clear existing data
        data.forEach((item) => {
          // Create a new table row element with table data
          const newRow = document.createElement("tr");

          // Populate the table
          newRow.innerHTML = `
        <td>${item.title}</td>
        <td>${item.category}</td>
        <td>${item.amount}</td>
        <td>${item.type}</td>
        <td>${item.date}</td>
      `;

          // Append the new row to the table body
          financeDataElement.appendChild(newRow);
        });
      }
      // Run it
      setInterval(fetchFinanceData, 5000);
    </script>
    <!--End of Script-->
  </body>
</html>
